# x-scheduler

A command-line tool for scheduling X (Twitter) posts using YAML configuration files and system cron.

## Features

- **Declarative Configuration**: Define posts and schedules in YAML
- **Cron Integration**: Leverages system cron for reliable scheduling
- **Stateless Design**: No database or persistent state required
- **RFC 3339 Time Format**: Standard-compliant time specifications
- **Test Mode**: Test posts immediately with dry-run capability

### System Requirements

- Linux/Unix system with cron
- Root access (for writing to `/etc/cron.d/`)
- [xurl](https://github.com/xdevplatform/xurl) command installed and configured

## Installation

### Prerequisites

x-scheduler uses [xurl](https://github.com/xdevplatform/xurl) for X API authentication and posts, which provides.

### Build

```bash
$ go build -o x-scheduler cmd/main.go
```

## Configuration

### YAML Configuration File

Create a YAML file with your scheduled posts:

```yaml
posts:
  # Regular scheduled posts
  - content: "Good morning! Ready to tackle the day ahead!"
    scheduled_at: "2025-06-01T08:00:00+09:00"
    enabled: true

  - content: "Weekly development update: Shipped 3 features this week!"
    scheduled_at: "2025-06-07T17:00:00+09:00"
    enabled: true

  # Past posts (kept as history - automatically skipped)
  - content: "Yesterday's post - already published"
    scheduled_at: "2025-05-23T10:00:00+09:00"
    enabled: true  # Will be automatically skipped

  - content: "Another past post"
    scheduled_at: "2025-05-23T15:00:00+09:00"
    # enabled omitted = false (disabled)

  # Test posts (execute immediately)
  - content: "Testing API connection"
    scheduled_at: "2025-06-01T09:00:00+09:00"
    enabled: true
    test: true

  # Dry run test (simulate posting without actually posting)
  - content: "This is a dry run test"
    scheduled_at: "2025-06-01T10:00:00+09:00"
    enabled: true
    test: true
    dry_run: true
```

#### Configuration Fields

- `content` (required): The text content of your post
- `scheduled_at` (required): When to post in RFC 3339 format
- `enabled` (optional): Set to `true` to enable the post (default: `false`)
- `test` (optional): Set to `true` to execute immediately for testing (default: `false`)
- `dry_run` (optional): Set to `true` to simulate posting without actually posting (requires `test: true`)

## Usage

### Validate Configuration

Check your configuration file for errors:

```bash
$ x-scheduler -validate config.yaml
```

Example output:
```
Info: 2 posts are scheduled in the past (consider disabling them)
Configuration validation successful
Total posts: 6
Enabled posts: 4
Future posts: 2
Poster: xurl command available

Upcoming posts:
  2025-06-01 08:00: Good morning! Ready to tackle the day ahead!
  2025-06-07 17:00: Weekly development update: Shipped 3 features this...
```

### Setup Cron Jobs

Generate cron configuration from your YAML file:

```bash
$ sudo x-scheduler -setup config.yaml
```

Example output:
```
Cron configuration preview:
# Generated by x-scheduler
# Do not edit manually

# 2025-06-01 08:00 - Good morning! Ready to tackle the day ahead!
0 8 1 6 * root /usr/local/bin/x-scheduler -execute /path/to/config.yaml

Successfully configured 2 scheduled posts
```

This creates `/etc/cron.d/x-scheduler` with appropriate cron entries.

### Execute Posts

Execute posts scheduled for the current time or test posts:

```bash
$ x-scheduler -execute config.yaml
```

Example output with test posts:
```
2025/05/24 10:30:15 [INFO] Test post 1/2: Testing API connection
✓ Test post successful: Testing API connection

2025/05/24 10:30:16 [INFO] Test post 2/2 (DRY RUN): This is a dry run test
✓ [DRY RUN] Would post: This is a dry run test
```

### Command Line Options

```
  -setup      Generate cron configuration from YAML file
  -execute    Execute scheduled posts for current time
  -validate   Validate configuration file
  -verbose    Enable verbose logging
  -version    Show version information
  -help       Show help message
```

## How It Works

1. **Setup Phase**: `x-scheduler -setup config.yaml`
   - Reads YAML configuration
   - Automatically skips posts scheduled in the past
   - Excludes test posts from cron schedule
   - Generates cron entries for future posts only
   - Writes to `/etc/cron.d/x-scheduler`

2. **Execution Phase**: Cron calls `x-scheduler -execute config.yaml`
   - Loads configuration at execution time
   - Finds posts matching current time (±1 minute)
   - Executes test posts immediately regardless of schedule
   - Posts to X API via xurl with detailed error logging

## Handling Post Failures

When x-scheduler fails to post a tweet, it does not automatically retry. Instead, it logs detailed error information from xurl to help you detect and resolve issues.

Failed posts are not automatically retried, so external monitoring and manual intervention are required.

## Flexible Past Post Handling

x-scheduler handles past posts gracefully:

- **Validation**: Past posts generate warnings but don't cause validation failures
- **Setup**: Past posts are automatically skipped when generating cron configuration
- **History**: You can keep past posts in your configuration file as history
- **No Manual Cleanup**: No need to manually disable or remove past posts

This design allows you to:
- Maintain a complete history of your scheduled posts
- Add new future posts without worrying about past entries
- Use the same configuration file over time without constant maintenance

## License

This project is licensed under the MIT License - see the [LICENSE](https://opensource.org/license/mit) for details.
